<!--  gestao/includes/_filtros_questoes  -->


{% comment %}
Este formulário foi adaptado para funcionar com o JavaScript fornecido,
usando dropdowns com checkboxes para seleção múltipla.
{% endcomment %}
<form id="form-filtros" 
      method="GET" 
      action="{{ request.path }}"
      data-assuntos-url="{% url 'questoes:get_assuntos_por_disciplina' %}"
      data-selected-assuntos="{{ selected_assuntos|safe|default:'[]' }}">

    <!-- Input oculto para manter o filtro de status ao submeter -->
    {% if request.GET.status %}
        <input type="hidden" name="status" value="{{ request.GET.status }}">
    {% endif %}

    <div class="row g-3">
        <!-- Busca por Palavra-chave -->
        <div class="col-12">
            <label for="palavra_chave" class="form-label">Busca por termo ou código</label>
            <input type="text" class="form-control" name="palavra_chave" id="palavra_chave" value="{{ palavra_chave_buscada|default:'' }}" placeholder="Ex: Direito Constitucional, Q12345">
        </div>

        <!-- Coluna de Filtros -->
        <div class="col-12">
            <div class="row g-2">
                <!-- Dropdown Disciplinas -->
                <div class="col-md-3">
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle w-100" type="button" id="dropdownDisciplina" data-bs-toggle="dropdown" aria-expanded="false">
                            Disciplina <span class="badge bg-primary rounded-pill" id="count-disciplina" style="display: none;">0</span>
                        </button>
                        <ul class="dropdown-menu p-3 w-100" aria-labelledby="dropdownDisciplina" onclick="(event) => event.stopPropagation()">
                            <input type="text" class="form-control form-control-sm mb-2" placeholder="Buscar disciplina..." onkeyup="filterDropdownOptions(this)">
                            <div class="dropdown-options-container">
                                {% for disciplina in disciplinas %}
                                <li>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="disciplina" value="{{ disciplina.id }}" id="disciplina-{{ disciplina.id }}" {% if disciplina.id in selected_disciplinas %}checked{% endif %}>
                                        <label class="form-check-label" for="disciplina-{{ disciplina.id }}">{{ disciplina.nome }}</label>
                                    </div>
                                </li>
                                {% endfor %}
                            </div>
                        </ul>
                    </div>
                </div>

                <!-- Dropdown Assuntos (Dinâmico) -->
                <div class="col-md-3">
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle w-100" type="button" id="dropdownAssunto" data-bs-toggle="dropdown" aria-expanded="false" disabled>
                            Assunto <span class="badge bg-primary rounded-pill" id="count-assunto" style="display: none;">0</span>
                        </button>
                        <ul class="dropdown-menu p-3 w-100" aria-labelledby="dropdownAssunto" onclick="(event) => event.stopPropagation()">
                            <input type="text" class="form-control form-control-sm mb-2" placeholder="Buscar assunto..." onkeyup="filterDropdownOptions(this)">
                            <div class="dropdown-options-container" id="options-assunto">
                                <!-- As opções serão carregadas aqui pelo JavaScript -->
                            </div>
                        </ul>
                    </div>
                </div>
                
                <!-- Outros filtros (Banca, Instituição, etc.) podem seguir o mesmo padrão de dropdown -->

            </div>
        </div>
    </div>

    <!-- Filtros Ativos e Botões -->
    <div id="active-filters-container" class="mt-4" style="display: none;"></div>
    <div class="text-center mt-4">
        <button type="submit" class="btn btn-primary px-5">
            <i class="fas fa-filter me-2"></i>Aplicar Filtros
        </button>
        <a href="{{ request.path }}" class="btn btn-outline-secondary px-4 ms-2">
            Limpar
        </a>
    </div>
</form>