<!-- gestao/templates/gestao/includes/_recompensa_form_fields.html -->
{% csrf_token %}

<h5 class="h6 mb-3">Dados da Recompensa</h5>
<div class="row">
    <div class="col-md-8"><div class="mb-3"><label for="{{ form.nome.id_for_label }}" class="form-label">{{ form.nome.label }}</label>{{ form.nome }}</div></div>
    <div class="col-md-4"><div class="mb-3"><label for="{{ form.raridade.id_for_label }}" class="form-label">{{ form.raridade.label }}</label>{{ form.raridade }}</div></div>
</div>
<div class="mb-3"><label for="{{ form.descricao.id_for_label }}" class="form-label">{{ form.descricao.label }}</label>{{ form.descricao }}</div>

<div class="mb-3">
    <label for="{{ form.imagem.id_for_label }}" class="form-label">Imagem</label>
    {{ form.imagem }} <!-- Input de arquivo padrão para todos os tipos -->
    {% if form.instance.imagem %}
        <small class="form-text text-muted d-block mt-1">Imagem atual: <a href="{{ form.instance.imagem.url }}" target="_blank">{{ form.instance.imagem.name|truncatechars:30 }}</a></small>
    {% endif %}
</div>

<!-- Preview apenas para Avatares e Bordas -->
{% if tipo == 'avatares' or tipo == 'bordas' %}
<div class="preview-container mb-4">
    {% if tipo == 'avatares' %}
        <div id="avatar-preview-wrapper"><img id="avatar-preview-image" src="{% if form.instance.imagem %}{{ form.instance.imagem.url }}{% endif %}" style="{% if not form.instance.imagem %}display:none;{% endif %}"></div>
    {% elif tipo == 'bordas' %}
        <div id="border-preview-wrapper"><div class="border-preview-placeholder"><i class="fas fa-user"></i></div><img id="border-preview-image" src="{% if form.instance.imagem %}{{ form.instance.imagem.url }}{% endif %}" style="{% if not form.instance.imagem %}display:none;{% endif %}"></div>
    {% endif %}
    <p id="preview-text" class="text-muted" style="{% if form.instance.imagem %}display:none;{% endif %}">A pré-visualização aparecerá aqui.</p>
</div>
{% endif %}

<hr>
<h5 class="h6 mb-3">Condição de Desbloqueio</h5>
<div class="mb-3"><label for="{{ form.tipo_desbloqueio.id_for_label }}" class="form-label">{{ form.tipo_desbloqueio.label }}</label>{{ form.tipo_desbloqueio }}</div>
<div id="requisito-nivel" class="mb-3"><label for="{{ form.nivel_necessario.id_for_label }}" class="form-label">{{ form.nivel_necessario.label }}</label>{{ form.nivel_necessario }}</div>
<div id="requisito-conquista" class="mb-3"><label for="{{ form.conquista_necessaria.id_for_label }}" class="form-label">{{ form.conquista_necessaria.label }}</label>{{ form.conquista_necessaria }}</div>

<div class="mt-4 d-flex justify-content-center gap-2"><a href="{% url 'gestao:listar_recompensas' tipo=tipo %}" class="btn btn-secondary">Cancelar</a><button type="submit" class="btn btn-primary px-5">Salvar</button></div>