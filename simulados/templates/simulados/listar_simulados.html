<!-- simulados/templates/simulados/listar_simulados.html -->

{% extends 'base.html' %}
{% load static %}

{% block title %}Simulados Disponíveis{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/listagem-comum.css' %}">
<style>
    .simulado-card {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        border-left: 4px solid var(--cor-primaria);
        display: flex; flex-direction: column;
    }
    .simulado-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--sombra-caixa-hover);
    }
    .simulado-card.pessoal {
        border-left-color: var(--cor-secundaria);
    }
    .btn-delete-simulado {
        z-index: 10;
        opacity: 0.5;
        transition: opacity 0.2s;
    }
    .simulado-card:hover .btn-delete-simulado {
        opacity: 1;
    }
    .badge-oficial {
        font-size: 0.7em;
        font-weight: 600;
        letter-spacing: 0.5px;
    }
    .badge-disciplina {
        font-size: 0.75em;
        background-color: #e9ecef !important;
        color: #495057 !important;
    }
    .bg-facil-soft { background-color: rgba(25, 135, 84, 0.1); }
    .text-facil { color: #146c43 !important; }
    .bg-medio-soft { background-color: rgba(255, 193, 7, 0.15); }
    .text-medio { color: #997404 !important; }
    .bg-dificil-soft { background-color: rgba(220, 53, 69, 0.1); }
    .text-dificil { color: #b02a37 !important; }
    .simulados-vitrine { display: flex; overflow-x: auto; padding-bottom: 1.5rem; scroll-snap-type: x mandatory; gap: 1.5rem; }
    .simulados-vitrine > div { flex: 0 0 90%; scroll-snap-align: start; }
    @media (min-width: 768px) { .simulados-vitrine > div { flex-basis: 40%; } }
    @media (min-width: 992px) { .simulados-vitrine > div { flex-basis: 31%; } }
    .simulados-vitrine::-webkit-scrollbar { display: none; }
    .simulados-vitrine { -ms-overflow-style: none; scrollbar-width: none; }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="display-6">Simulados Preparatórios</h1>
        <p class="lead text-muted">Teste seus conhecimentos em um ambiente que simula as condições reais de prova.</p>
    </div>

    {% include 'gestao/includes/_messages.html' %}

    <!-- SEÇÃO DE SIMULADOS OFICIAIS (VITRINE) -->
    <div class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="mb-0 d-flex align-items-center gap-2"><i class="fas fa-crown text-warning"></i> Simulados Populares da Plataforma</h3>
            <a href="{% url 'simulados:listar_simulados_oficiais' %}" class="btn btn-outline-primary btn-sm">Ver Todos <i class="fas fa-arrow-right ms-1"></i></a>
        </div>
        <div class="simulados-vitrine-wrapper">
            <div class="simulados-vitrine">
                {% for simulado in simulados_oficiais %}
                    {% include 'simulados/includes/_simulado_card_oficial.html' with simulado=simulado %}
                {% empty %}
                    <div class="col-12"><div class="card card-body text-center p-5 bg-light"><i class="fas fa-box-open fa-3x text-muted mb-3"></i><h5 class="text-muted">Nenhum simulado oficial disponível no momento.</h5></div></div>
                {% endfor %}
            </div>
        </div>
    </div>

    <hr class="my-5">

    <!-- SEÇÃO DE SIMULADOS PESSOAIS -->
    <div>
        <h3 class="mb-4 d-flex align-items-center gap-2"><i class="fas fa-user-cog text-secondary"></i> Meus Simulados Personalizados</h3>
        <div class="row g-4">
            <div class="col-lg-4 col-md-6">
                <!-- ESTE INCLUDE AGORA LEVA PARA A PÁGINA CORRETA -->
                {% include 'simulados/includes/_card_gerar_simulado.html' %}
            </div>
            {% for simulado in simulados_pessoais %}
            <div class="col-lg-4 col-md-6">
                {% include 'simulados/includes/_simulado_card_pessoal.html' with simulado=simulado %}
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="mt-5">
        {% include 'includes/_paginacao.html' with paginated_object=simulados_pessoais %}
    </div>
</div>

<!-- Modal de Confirmação para Excluir -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Confirmar Exclusão</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>Você tem certeza de que deseja excluir o simulado <strong id="simuladoNomeParaExcluir"></strong>?</p><p class="text-danger small">Esta ação não pode ser desfeita e todo o histórico associado será perdido.</p></div><div class="modal-footer"><form id="deleteForm" method="POST" action="">{% csrf_token %}<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="submit" class="btn btn-danger">Excluir</button></form></div></div></div></div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const confirmDeleteModal = document.getElementById('confirmDeleteModal');
    if (confirmDeleteModal) {
        confirmDeleteModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const simuladoId = button.getAttribute('data-simulado-id');
            const simuladoNome = button.getAttribute('data-simulado-nome');
            const modalBodyStrong = confirmDeleteModal.querySelector('#simuladoNomeParaExcluir');
            const deleteForm = confirmDeleteModal.querySelector('#deleteForm');
            modalBodyStrong.textContent = `"${simuladoNome}"`;
            deleteForm.setAttribute('action', `/simulados/${simuladoId}/excluir/`);
        });
    }
});
window.addEventListener('pageshow', function(event) { if (event.persisted) { window.location.reload(); } });
</script>
{% endblock %}