<!-- templates/includes/_filtros_questoes.html -->

<div class="card filtros-card mb-4 p-4">
    <h5 class="card-title mb-4">Filtrar Questões</h5>
    
    <form id="form-filtros" 
          method="GET" 
          action="{{ form_action_url }}"
          data-assuntos-url="{% url 'questoes:get_assuntos_por_disciplina' %}"
          data-selected-assuntos="[{{ selected_assuntos|join:',' }}]">
        
        {% if status_param is not None %}
        <input type="hidden" name="status" value="{{ status_param }}">
        {% endif %}

        <div class="row g-3">
            <!-- Palavra Chave -->
            <div class="col-12 mb-3">
                <div class="input-group">
                    <span class="input-group-text bg-light border-end-0"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control border-start-0" name="palavra_chave" value="{{ palavra_chave_buscada|default:'' }}" placeholder="Buscar por palavra-chave ou código (ex: Q123)">
                </div>
            </div>

            <!-- Dropdowns de Filtro -->
            <!-- MUDANÇA: Adicionado 'col-12' para garantir que em telas pequenas cada filtro ocupe uma linha inteira -->
            <div class="col-12 col-md-3">
                <div class="dropdown filter-dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                        Disciplina <span class="badge bg-primary rounded-pill float-end" id="count-disciplina" style="display: none;">0</span>
                    </button>
                    <div class="dropdown-menu p-3">
                        <input type="text" class="form-control form-control-sm mb-2" placeholder="Busca rápida..." onkeyup="filterDropdownOptions(this)">
                        <ul class="filter-dropdown-options">
                            {% for d in disciplinas %}{% if d.nome %}<li><div class="form-check"><input class="form-check-input" type="checkbox" name="disciplina" value="{{ d.id }}" id="disciplina-{{ d.id }}" {% if d.id in selected_disciplinas %}checked{% endif %}><label class="form-check-label" for="disciplina-{{ d.id }}">{{ d.nome }}</label></div></li>{% endif %}{% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-3">
                <div class="dropdown filter-dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" id="dropdownAssunto" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                        Assunto <span class="badge bg-primary rounded-pill float-end" id="count-assunto" style="display: none;">0</span>
                    </button>
                    <div class="dropdown-menu p-3">
                        <input type="text" class="form-control form-control-sm mb-2" placeholder="Busca rápida..." onkeyup="filterDropdownOptions(this)">
                        <ul class="filter-dropdown-options" id="options-assunto"></ul>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-3">
                <div class="dropdown filter-dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                        Banca <span class="badge bg-primary rounded-pill float-end" id="count-banca" style="display: none;">0</span>
                    </button>
                    <div class="dropdown-menu p-3">
                        <input type="text" class="form-control form-control-sm mb-2" placeholder="Busca rápida..." onkeyup="filterDropdownOptions(this)">
                        <ul class="filter-dropdown-options">
                            {% for b in bancas %}{% if b.nome %}<li><div class="form-check"><input class="form-check-input" type="checkbox" name="banca" value="{{ b.id }}" id="banca-{{ b.id }}" {% if b.id in selected_bancas %}checked{% endif %}><label class="form-check-label" for="banca-{{ b.id }}">{{ b.nome }}</label></div></li>{% endif %}{% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-3">
                <div class="dropdown filter-dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                        Instituição <span class="badge bg-primary rounded-pill float-end" id="count-instituicao" style="display: none;">0</span>
                    </button>
                    <div class="dropdown-menu p-3">
                        <input type="text" class="form-control form-control-sm mb-2" placeholder="Busca rápida..." onkeyup="filterDropdownOptions(this)">
                        <ul class="filter-dropdown-options">
                            {% for i in instituicoes %}{% if i.nome %}<li><div class="form-check"><input class="form-check-input" type="checkbox" name="instituicao" value="{{ i.id }}" id="instituicao-{{ i.id }}" {% if i.id in selected_instituicoes %}checked{% endif %}><label class="form-check-label" for="instituicao-{{ i.id }}">{{ i.nome }}</label></div></li>{% endif %}{% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-12 col-md-3">
                 <div class="dropdown filter-dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                        Ano <span class="badge bg-primary rounded-pill float-end" id="count-ano" style="display: none;">0</span>
                    </button>
                    <div class="dropdown-menu p-3">
                        <ul class="filter-dropdown-options">
                            {% for a in anos %}{% if a %}<li><div class="form-check"><input class="form-check-input" type="checkbox" name="ano" value="{{ a }}" id="ano-{{ a }}" {% if a in selected_anos %}checked{% endif %}><label class="form-check-label" for="ano-{{ a }}">{{ a }}</label></div></li>{% endif %}{% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-center align-items-center mt-4 pt-3 border-top">
            <button type="submit" class="btn btn-primary px-4 me-2">Aplicar Filtros</button>
            <a href="{{ form_action_url }}" class="btn btn-outline-secondary px-4">Limpar</a>
        </div>
    </form>
    <div class="mt-4 pt-3 border-top" id="active-filters-container" style="display: none;">
        <strong class="me-2">Filtros Ativos:</strong>
    </div>
</div>