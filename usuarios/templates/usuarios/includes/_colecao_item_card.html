<!-- usuarios/templates/usuarios/includes/_colecao_item_card.html -->

{% load colecao_extras %}
{% load static %}


<link rel="stylesheet" href="{% static 'css/listagem-comum.css' %}">

<div class="col">
    <div class="card h-100 collection-card {% rarity_class item.raridade %} {% if item.id in desbloqueados_ids %}unlocked{% else %}locked{% endif %}">
        
        <div class="card-img-container">
            {% if item.imagem %}
                <img src="{{ item.imagem.url }}" class="card-img-top" alt="{{ item.nome }}">
            {% else %}
                <!-- 2. Se não houver imagem, mostramos um placeholder genérico -->
                <div class="card-img-top d-flex align-items-center justify-content-center bg-light">
                    <i class="fas fa-image fa-3x text-muted"></i>
                </div>
            {% endif %}
            <span class="badge rarity-badge {% rarity_class item.raridade %}">{{ item.get_raridade_display }}</span>
        </div>

        <div class="card-body">
            <h5 class="card-title">{{ item.nome }}</h5>
            {% if item.descricao %}
                <p class="card-text">{{ item.descricao }}</p>
            {% endif %}
        </div>

        <!-- ======================================================================= -->
        <!-- INÍCIO DA CORREÇÃO: Centralizando e ajustando a largura do botão -->
        <!-- ======================================================================= -->
        <div class="card-footer d-flex justify-content-center">
            {% if item.id in desbloqueados_ids %}
                {% if equipado_id == item.id %}
                    <button class="btn btn-sm btn-success" disabled>
                        <i class="fas fa-check-circle me-2"></i>Equipado
                    </button>
                {% else %}
                    {% if tipo_item == 'avatar' %}
                        <a href="{% url 'equipar_avatar' item.id %}" class="btn btn-sm btn-celestial">
                            <span><i class="fas fa-star me-2"></i>Equipar</span>
                            <div class="star-1"></div><div class="star-2"></div><div class="star-3"></div><div class="star-4"></div><div class="star-5"></div><div class="star-6"></div>
                        </a>
                    {% elif tipo_item == 'borda' %}
                         <a href="{% url 'equipar_borda' item.id %}" class="btn btn-sm btn-celestial"
                            {% if not user_profile.avatar_equipado %} disabled data-bs-toggle="tooltip" title="Você precisa equipar um avatar primeiro." {% endif %}>
                            <span><i class="fas fa-ring me-2"></i>Equipar</span>
                            <div class="star-1"></div><div class="star-2"></div><div class="star-3"></div><div class="star-4"></div><div class="star-5"></div><div class="star-6"></div>
                        </a>
                    {% elif tipo_item == 'banner' %}
                         <a href="{% url 'equipar_banner' item.id %}" class="btn btn-sm btn-celestial">
                            <span><i class="fas fa-image me-2"></i>Equipar</span>
                            <div class="star-1"></div><div class="star-2"></div><div class="star-3"></div><div class="star-4"></div><div class="star-5"></div><div class="star-6"></div>
                        </a>
                    {% endif %}
                {% endif %}
            {% else %}
                <button class="btn btn-sm btn-secondary" disabled><i class="fas fa-lock me-2"></i>Bloqueado</button>
            {% endif %}
        </div>
        <!-- ======================================================================= -->
        <!-- FIM DA CORREÇÃO -->
        <!-- ======================================================================= -->
    </div>
</div>