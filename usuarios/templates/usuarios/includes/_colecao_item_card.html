<!-- usuarios/templates/usuarios/includes/_colecao_item_card.html -->
{% load colecao_extras %}
{% load static %}


<link rel="stylesheet" href="{% static 'css/listagem-comum.css' %}">

<div class="col">
    <!-- ======================================================================= -->
    <!-- INÍCIO DA ALTERAÇÃO: Adicionando data attributes para o modal -->
    <!-- ======================================================================= -->
    <div class="card h-100 collection-card {% rarity_class item.raridade %} {% if item.id in desbloqueados_ids %}unlocked{% else %}locked{% endif %}"
         data-name="{{ item.nome }}"
         data-description="{{ item.descricao }}"
         data-image="{% if item.imagem %}{{ item.imagem.url }}{% else %}{% endif %}"
         data-rarity="{{ item.get_raridade_display }}"
         data-type="{{ tipo_item|capfirst }}"
         data-owned="{% if item.id in desbloqueados_ids %}true{% else %}false{% endif %}">
    <!-- ======================================================================= -->
    <!-- FIM DA ALTERAÇÃO -->
    <!-- ======================================================================= -->
        
        <div class="card-img-container">
            {% if item.imagem %}
                <img src="{{ item.imagem.url }}" class="card-img-top" alt="{{ item.nome }}">
            {% else %}
                <!-- 2. Se não houver imagem, mostramos um placeholder genérico -->
                <div class="card-img-top d-flex align-items-center justify-content-center bg-light">
                    <i class="fas fa-image fa-3x text-muted"></i>
                </div>
            {% endif %}
            <span class="badge rarity-badge {% rarity_class item.raridade %}">{{ item.get_raridade_display }}</span>
        </div>

        <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ item.nome }}</h5>
            <!-- ======================================================================= -->
            <!-- INÍCIO DA ALTERAÇÃO: Lógica de truncamento e link para modal -->
            <!-- ======================================================================= -->
            {% if item.descricao %}
                <p class="card-text small mb-1">{{ item.descricao|truncatewords:12 }}</p>
                {% if item.descricao|wordcount > 12 %}
                    <a href="#" class="view-details-link small mt-auto" data-bs-toggle="modal" data-bs-target="#itemDetailModal" style="text-decoration: none;">
                        Ver mais...
                    </a>
                {% endif %}
            {% endif %}
            <!-- ======================================================================= -->
            <!-- FIM DA ALTERAÇÃO -->
            <!-- ======================================================================= -->
        </div>

        <div class="card-footer d-flex justify-content-center">
            {% if item.id in desbloqueados_ids %}
                {% if equipado_id == item.id %}
                    <button class="btn btn-sm btn-success" disabled>
                        <i class="fas fa-check-circle me-2"></i>Equipado
                    </button>
                {% else %}
                    {% if tipo_item == 'avatar' %}
                        <a href="{% url 'equipar_avatar' item.id %}" class="btn btn-sm btn-celestial">
                            <span><i class="fas fa-star me-2"></i>Equipar</span>
                            <div class="star-1"></div><div class="star-2"></div><div class="star-3"></div><div class="star-4"></div><div class="star-5"></div><div class="star-6"></div>
                        </a>
                    {% elif tipo_item == 'borda' %}
                         <a href="{% url 'equipar_borda' item.id %}" class="btn btn-sm btn-celestial"
                            {% if not user_profile.avatar_equipado %} disabled data-bs-toggle="tooltip" title="Você precisa equipar um avatar primeiro." {% endif %}>
                            <span><i class="fas fa-ring me-2"></i>Equipar</span>
                            <div class="star-1"></div><div class="star-2"></div><div class="star-3"></div><div class="star-4"></div><div class="star-5"></div><div class="star-6"></div>
                        </a>
                    {% elif tipo_item == 'banner' %}
                         <a href="{% url 'equipar_banner' item.id %}" class="btn btn-sm btn-celestial">
                            <span><i class="fas fa-image me-2"></i>Equipar</span>
                            <div class="star-1"></div><div class="star-2"></div><div class="star-3"></div><div class="star-4"></div><div class="star-5"></div><div class="star-6"></div>
                        </a>
                    {% endif %}
                {% endif %}
            {% else %}
                <!-- ======================================================================= -->
                <!-- INÍCIO DA ALTERAÇÃO: Adicionado tooltip para itens bloqueados -->
                <!-- ======================================================================= -->
                <button class="btn btn-sm btn-secondary" disabled data-bs-toggle="tooltip" title="Continue respondendo questões, completando metas e participando de eventos para desbloquear!">
                    <i class="fas fa-lock me-2"></i>Bloqueado
                </button>
                <!-- ======================================================================= -->
                <!-- FIM DA ALTERAÇÃO -->
                <!-- ======================================================================= -->
            {% endif %}
        </div>
    </div>
</div>